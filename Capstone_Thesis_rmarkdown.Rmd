---
title: "Capstone Thesis.R.markdown"
Author: Arielle Ca√±ate
date: "2025-04-28"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
---
###Researching connections between poverty and food scarcity:
##Examining NY counties and trying to see how these very important intersections 
##between race, age, education, income and whether or not you receive important 
###benefits 


```{r setup, include=FALSE}
# Set CRAN mirror explicitly
if (!length(getOption("repos"))) {
  options(repos = c(CRAN = "https://cloud.r-project.org"))
}

# Basic setup
knitr::opts_chunk$set(echo = TRUE)

# Check and install required packages
if (!require("tidyverse")) {
  install.packages("tidyverse", dependencies = TRUE)
}
if (!require("tidycensus")) {
  install.packages("tidycensus", dependencies = TRUE)
}

# Load packages
library(tidyverse)
library(tidycensus)
```



```{r echo=TRUE}
knitr::opts_chunk$set(echo = TRUE)
setwd("C:/Users/acana/OneDrive/Pictures/QMSS CAPSTONE")
require(data.table)
install.packages("tidycensus")
```

```{r echo=TRUE}
knitr::opts_chunk$set(echo = TRUE)
require(tidycensus)
require(ggplot2)
census_api_key("aa512886c5449a582d837da8d3a07af66a043fe5")
```


```{r}
knitr::opts_chunk$set(echo = TRUE)
census_data <- load_variables(2023, "acs5", cache=T)
View(census_data) 
```


```{r}
knitr::opts_chunk$set(echo = TRUE)
vars <- c(Total = 'B01003_001',  
          Poverty = 'B05010_001',
          Did_Not_Recieve = 'B22007_023',
          Income = 'B99191_008', 
          Educ = 'C15010F_005',
          medage = 'B01002_001',
          bpop = 'B02001_003',
          wpop = 'B02001_002',
          hpop = 'B03002_012',
          apop = 'B02001_005') 

View(vars)
```


```{r}
knitr::opts_chunk$set(echo = TRUE)
NY_data <- get_acs(state = "NY", 
                geography = "county",
                variables = vars, 
                geometry = TRUE,
                survey = "acs5",
                output = "wide")

View(NY_data)
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
NY_data_estimates <- NY_data %>%
  select(GEOID, NAME, ends_with("E"))
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
NY_data_estimates$pct_pov <- (NY_data_estimates$PovertyE/NY_data_estimates$TotalE)*100
summary(NY_data_estimates$pct_pov)
summary(NY_data_estimates)
View(NY_data_estimates)
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
plot(NY_data_estimates)
plot(NY_data_estimates["TotalE"])
plot(NY_data_estimates["pct_pov"])
plot(NY_data_estimates["medageE"])
plot(NY_data_estimates["EducE"])
plot(NY_data_estimates['bpopE'])
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
NY_data$geometry <- NULL
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
NY_data_estimates$incpct <- (NY_data_estimates$IncomeE / NY_data_estimates$TotalE) *100
NY_data_estimates$did_notreceivepct <- (NY_data_estimates$Did_Not_RecieveE / NY_data_estimates$TotalE) *100
NY_data_estimates$agepct <- (NY_data_estimates$medageE / NY_data_estimates$TotalE) *100
NY_data_estimates$povpct <- (NY_data_estimates$pct_pov/NY_data_estimates$TotalE) *100
NY_data_estimates$educpct <- (NY_data_estimates$EducE / NY_data_estimates$TotalE)*100
NY_data_estimates$bpct <- (NY_data_estimates$bpopE / NY_data_estimates$TotalE) *100
NY_data_estimates$wpct <- (NY_data_estimates$wpopE / NY_data_estimates$TotalE) *100
```

###Add race diversity
```{r}
knitr::opts_chunk$set(echo = TRUE)
NY_data_estimates$race_div <- 1 - (((NY_data_estimates$wpopE*(NY_data_estimates$wpopE-1))+
                          (NY_data_estimates$bpopE*(NY_data_estimates$bpopE-1))+
                          (NY_data_estimates$hpopE*(NY_data_estimates$hpopE-1))+
                          (NY_data_estimates$apopE*(NY_data_estimates$apopE-1)))/
                         (NY_data_estimates$TotalE*(NY_data_estimates$TotalE-1)))

head(NY_data_estimates)
summary(NY_data_estimates$race_div)
plot(NY_data_estimates["race_div"])
```

###Bivariate Analysis: Ttests seeing the relation between race, age, education,
###connecting to poverty.
```{r}
knitr::opts_chunk$set(echo = TRUE)
NY_data_estimates$age_group <- ifelse(NY_data_estimates$agepct >
                                        median(NY_data_estimates$agepct, 
                                               na.rm = TRUE), "High", "Low")
Ttest_medage <- t.test(povpct ~ age_group, data = NY_data_estimates)

NY_data_estimates$race_group <- ifelse(NY_data_estimates$race_div >
                                         median(NY_data_estimates$race_div, 
                                                na.rm = TRUE), "High", "Low")
Ttest_race <- t.test(povpct ~ race_group, data = NY_data_estimates)

NY_data_estimates$no_service <- ifelse(NY_data_estimates$did_notreceivepct >
                                         median(NY_data_estimates$did_notreceivepct, 
                                                na.rm = TRUE), "High", "Low")
Ttest_noservice <- t.test(povpct ~ no_service, data = NY_data_estimates)

NY_data_estimates$educ <- ifelse(NY_data_estimates$educpct >
                                         median(NY_data_estimates$educpct,
                                                na.rm = TRUE), "High", "Low")
Ttest_educ <- t.test(povpct ~ educ, data = NY_data_estimates)
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
Ttest_medage
Ttest_race
Ttest_noservice
Ttest_educ
```

###Is race and not being able to receive services related to poverty?
```{r}
knitr::opts_chunk$set(echo = TRUE)
ANOVA_noserv <- aov(povpct ~ race_div * no_service, data = NY_data_estimates)
summary(ANOVA_noserv)
```


```{r}
knitr::opts_chunk$set(echo = TRUE)
hist(NY_data_estimates$pct_pov)
hist(NY_data_estimates$race_div)
```
```{r}
knitr::opts_chunk$set(echo = TRUE)
TukeyHSD(ANOVA_noserv)
```

####Research Question: Is there a significant difference in poverty rates between
##counties with high versus low rates of residents who did not receive services?

```{r}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)

ggplot(NY_data_estimates, aes(x = no_service, y = povpct, fill = no_service)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.5, color = "black") +
  labs(
    title = "Poverty Percentage by Service Access Group",
    x = "No Service Group (High/Low)",
    y = "Poverty Percentage"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("High" = "#d62728", "Low" = "#2ca02c")) +
  theme(legend.position = "none")
```

###Education?
```{r}
knitr::opts_chunk$set(echo = TRUE)
ggplot(NY_data_estimates, aes(x = educ, y = povpct, fill = educ)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Poverty Percentage by Education Group",
    x = "Education Group",
    y = "Poverty Percentage"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("High" = "#1f77b4", "Low" = "#ff7f0e")) +
  theme(legend.position = "none")
```

##Race?
```{r}
knitr::opts_chunk$set(echo = TRUE)
ggplot(NY_data_estimates, aes(x = povpct, y = povpct, fill = race_group)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Poverty Percentage by Racial Group",
    x = "Racial Group",
    y = "Poverty Percentage"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("High" = "#1f77b4", "Low" = "#ff7f0e")) +
  theme(legend.position = "none")
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)

NY_data_estimates %>%
  group_by(race_group, no_service) %>%
  summarise(mean_povpct = mean(povpct, na.rm = TRUE)) %>%
  ggplot(aes(x = race_group, y = no_service, fill = mean_povpct)) +
  geom_tile() +
  geom_text(aes(label = round(mean_povpct, 3)), color = "white") +
  labs(
    title = "Mean Poverty Percentage by Race Diversity and Service Access",
    x = "Race Diversity Group",
    y = "Service Access",
    fill = "Poverty %"
  ) +
  theme_minimal() +
  scale_fill_gradient(low = "#2ca02c", high = "#d62728") +
  theme(legend.position = "bottom")
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
####NYC Counties
require(data.table)
neighbor_class <- fread ("Neighborhood_Prioritization_Map_2023.csv", 
                          stringsAsFactors = F, 
                          data.table = F)

```

```{r}
knitr::opts_chunk$set(echo = TRUE)
require(ggplot2)
names(neighbor_class)
head(neighbor_class)
View(neighbor_class)
neighbor_class <- neighbor_class[,c(2,6,8,10,13)]

names(neighbor_class)
head(neighbor_class)
```

```{r}
knitr::opts_chunk$set(echo = TRUE)
summary(neighbor_class$'SNAP Perc Rank along Adj Weighted Score')
summary(neighbor_class$'Vulnerable pop perc rank along Adj Weighted Score')
summary(neighbor_class$'Food insecure percentage rank along Adj Weighted Score')

neighbor_class$foodins_binary <- ifelse(neighbor_class$'Food insecure percentage rank along Adj Weighted Score'
                                        <mean(neighbor_class$'Food insecure percentage rank along Adj Weighted Score'),
                            "Below Avg. Food Insecur ","Above Avg. Food Insecur")

table(neighbor_class$foodins_binary)
```


```{r}
knitr::opts_chunk$set(echo = TRUE)
foodins_table <- table(neighbor_class$foodins_binary)
foodins_prop <- prop.table(foodins_table)
print(foodins_prop)

pie(foodins_table,
    main = "Proportion of Respondents Above/Below Avg. Food Insecurity",
    col = c("tomato", "skyblue"),
    labels = paste(names(foodins_table), "\n", foodins_table))
```

